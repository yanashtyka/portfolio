(function(){"use strict";async function e(e,t,n=null,l=!1,s=!1,i=!1){if(!e)return;const r={data:t,enableLinks:l,emptyIcon:"glyphicon glyphicon-file",highlightSelected:!0,showIcon:!1,selectedColor:!1,selectedBackColor:!1,showBorder:!1,showTags:i},c=null!=e.closest("form")?e.closest("form").querySelector('input[name="project_ids"]'):null;s&&null!=c&&(r.showCheckbox=!0,r.onNodeChecked=function(e,t){let n=""!=c.value?c.value.split(","):[];n.push(t.id),c.value=n.join(",")},r.onNodeUnchecked=function(e,t){let n=""!=c.value?c.value.split(","):[];n=n.filter(e=>e!=t.id),c.value=n.join(",")});const d=null!=e.closest("form")?e.closest("form").querySelector('input[name="project_id"]'):null;if(null!=d&&(r.onNodeSelected=function(e,t){d.value=t.id}),$(e).treeview(r),e.querySelector(".list-group").classList.add("list"),null!=n&&(n.querySelector("input.search").style.width="-webkit-fill-available",n.querySelector("input.search").addEventListener("keyup",t=>{$(e).treeview("collapseAll",{silent:!0}),$(e).treeview("search",[t.target.value.length>=3?t.target.value:"",{ignoreCase:!0,exactMatch:!1,revealResults:!0}])})),null!=c){$(e).treeview("uncheckAll",{silent:!0});const t=""!=c.value?c.value.split(","):[],n=$(e).treeview("getEnabled").filter(e=>t.includes(e.id));n.forEach(t=>{$(e).treeview("checkNode",t)})}if(null!=d){const t=d.value,n=$(e).treeview("getEnabled").filter(e=>e.id==t);t&&$(e).treeview("selectNode",n)}const a=$(e).treeview("getSelected");a.length>0&&$(e).treeview("revealNode",a),o(e)}function t(e,n){const l=[],o=n[e].firstElementChild.textContent.match(/^\s+/),s=null!=o?o[0].length:0;for(let o=e;o<n.length;o++){const e=n[o],i=n[o+1],r=null!=i?i.firstElementChild.textContent.match(/^\s+/):null,c=null!=r?r[0].length:0;if(c>s){const s=t(o+1,n);o=s.index;let i={text:e.firstElementChild.textContent.trim(),nodes:s.nodes,href:void 0!==e.firstElementChild.href?e.firstElementChild.href:"#",selectable:!0,state:{selected:e.classList.contains("active"),expanded:!1}};void 0!==e.dataset.projectId&&(i.id=e.dataset.projectId),l.push(i)}else{const t={text:e.firstElementChild.textContent.trim(),href:void 0!==e.firstElementChild.href?e.firstElementChild.href:"#",selectable:!0,state:{selected:e.classList.contains("active"),expanded:!1}};void 0!==e.dataset.projectId&&(t.id=e.dataset.projectId),l.push(t)}if(c<s)return{index:o,nodes:l}}return{index:n.length-1,nodes:l}}async function n(e="",t=!1,n=!1){const o=`${t}${n}`;if(!i[o]){i[o]=[];let e="/api/rest/projects-tree/projects";n&&(e+="?show_disabled=1");const t=await fetch(e).then(e=>e.json()).then(e=>e);if(!t.length)return[];i[o]=t}const s=i[o].map(n=>l(n,e,t)).filter(e=>!!e);return s}function l(e,t="",n=!1){if(n&&e.id===s)return null;const o={id:e.id,href:t?t+e.id:"#",selectable:!0,state:{expanded:!1,selected:e.current},tags:[],text:`${e.name}`};return o.tags.push(e.enabled?"":"disabled"),e.total>0||!e.subprojects.length?(o.tags.push(`${e.total_assigned}`),o.tags.push(`${e.total}`)):(o.tags.push(""),o.tags.push("")),e.subprojects.length&&(o.nodes=e.subprojects.map(e=>l(e,t,n)).filter(e=>!!e)),o}function o(e){if(null==e.closest("#dropdown_projects_menu"))return;const t=$(e.closest("#dropdown_projects_menu"));let n=!0;e.addEventListener("click",function(e){n=!1}),t.on("hide.bs.dropdown",function(e){if(!n)return n=!0,e.preventDefault(),!1}),t.on("shown.bs.dropdown",function(e){const n=$(t.find(".scrollable-menu")),l=$(n.find(".node-selected"));t.find(".scrollable-menu").animate({scrollTop:l.offset().top-n.offset().top-5*l.outerHeight()},800)})}const s=0,i={};document.addEventListener("DOMContentLoaded",async l=>{const o=document.getElementById("projects-list"),s=document.getElementById("project-tree-page"),i=document.getElementById("project-tree-user");o&&e(o.querySelector(".scrollable-menu"),await n("/set_project.php?project_id="),o.querySelector(".projects-searchbox"),!0,!1,!0),s&&e(s,await n("/manage_proj_edit_page.php?project_id=",!0,!0),document.getElementById("project-tree-page-searchbox"),!0,!0,!0),i&&e(i,t(0,i.querySelectorAll("ul li:not(.divider)")).nodes,null,!1,!0)})})();